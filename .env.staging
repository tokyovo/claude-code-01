# =================================
# Personal Finance Tracker - Staging Environment Configuration
# This environment is used for testing production-like deployments
# =================================

# =================================
# Application Configuration
# =================================
NODE_ENV=staging
PORT=3000
HOST=0.0.0.0

# API Configuration
API_PREFIX=/api
API_VERSION=v1
API_RATE_LIMIT_WINDOW_MS=900000
API_RATE_LIMIT_MAX_REQUESTS=200

# =================================
# Database Configuration (PostgreSQL)
# =================================
DB_HOST=postgres
DB_PORT=5432
DB_NAME=personal_finance_tracker_staging
DB_USER=postgres
DB_PASSWORD=staging_secure_password

# SSL Configuration
DB_SSL=false
DB_SSL_REJECT_UNAUTHORIZED=false

# Connection Pool Configuration (Staging)
DB_POOL_MIN=2
DB_POOL_MAX=15
DB_ACQUIRE_TIMEOUT_MS=30000
DB_CREATE_TIMEOUT_MS=30000
DB_IDLE_TIMEOUT_MS=300000

# Query Configuration
DB_QUERY_TIMEOUT_MS=30000
DB_STATEMENT_TIMEOUT_MS=30000

# Debug Configuration (More verbose in staging)
DEBUG_SQL=false
LOG_QUERIES=true

# Migration Configuration
RUN_MIGRATIONS_ON_STARTUP=false
RUN_SEEDS_ON_STARTUP=true

# =================================
# Redis Configuration
# =================================
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=staging_redis_password
REDIS_DB=1
REDIS_KEY_PREFIX=finance_tracker_staging:

# Redis Connection Options
REDIS_CONNECT_TIMEOUT=10000
REDIS_COMMAND_TIMEOUT=5000
REDIS_RETRY_DELAY_ON_FAILOVER=100
REDIS_MAX_RETRIES_PER_REQUEST=3

# =================================
# Security Configuration
# =================================
JWT_SECRET=staging_jwt_secret_key_change_in_production
JWT_EXPIRES_IN=30m
JWT_REFRESH_SECRET=staging_jwt_refresh_secret_key_change_in_production
JWT_REFRESH_EXPIRES_IN=7d

# Password Security
BCRYPT_ROUNDS=10

# CORS Configuration (Staging)
CORS_ORIGIN=https://staging.yourdomain.com
CORS_CREDENTIALS=true

# Security Headers
ENABLE_HELMET=true
ENABLE_RATE_LIMITING=true
FORCE_HTTPS=false
HSTS_MAX_AGE=0

# =================================
# Logging Configuration (Staging)
# =================================
LOG_LEVEL=info
LOG_FORMAT=combined
LOG_FILE_PATH=/app/logs/app.log
LOG_MAX_SIZE=20m
LOG_MAX_FILES=5
LOG_DATE_PATTERN=YYYY-MM-DD

# More verbose logging in staging
LOG_HTTP_REQUESTS=true
LOG_DATABASE_QUERIES=true
LOG_ERROR_STACK_TRACES=true

# =================================
# File Upload Configuration
# =================================
UPLOAD_MAX_FILE_SIZE=5242880
UPLOAD_ALLOWED_TYPES=image/jpeg,image/png,image/gif,application/pdf
UPLOAD_DESTINATION=/app/uploads
UPLOAD_TEMP_DESTINATION=/app/uploads/temp

# =================================
# Email Configuration (Test Email Service)
# =================================
EMAIL_HOST=smtp.mailtrap.io
EMAIL_PORT=2525
EMAIL_USER=your_mailtrap_user
EMAIL_PASSWORD=your_mailtrap_password
EMAIL_FROM=Personal Finance Tracker Staging <staging@yourdomain.com>

# Email Security (Relaxed for staging)
EMAIL_SECURE=false
EMAIL_TLS_REJECT_UNAUTHORIZED=false

# Email Features
ENABLE_EMAIL_VERIFICATION=true
ENABLE_PASSWORD_RESET_EMAIL=true
ENABLE_SECURITY_ALERTS=false
EMAIL_VERIFICATION_EXPIRY=24h
PASSWORD_RESET_EXPIRY=1h

# =================================
# Backup Configuration
# =================================
AUTO_BACKUP_ENABLED=false
BACKUP_SCHEDULE=0 4 * * *
BACKUP_RETENTION_DAYS=7
BACKUP_DESTINATION=/backups
BACKUP_COMPRESSION=false

# =================================
# Monitoring & Analytics
# =================================
# Health Checks
ENABLE_HEALTH_CHECKS=true
HEALTH_CHECK_PATH=/health
METRICS_PATH=/metrics

# Performance Monitoring
ENABLE_PERFORMANCE_MONITORING=true
SLOW_QUERY_THRESHOLD_MS=500
SLOW_REQUEST_THRESHOLD_MS=1000

# Error Tracking (Optional)
ERROR_TRACKING_DSN=
ENABLE_ERROR_TRACKING=false

# =================================
# Performance Configuration
# =================================
# Compression
ENABLE_COMPRESSION=true
COMPRESSION_LEVEL=4
COMPRESSION_THRESHOLD=1024

# Caching (Less aggressive in staging)
CACHE_DEFAULT_TTL=60
CACHE_MAX_KEYS=1000
ENABLE_QUERY_CACHE=true
ENABLE_RESPONSE_CACHE=false

# ETag Support
ENABLE_ETAG=true

# =================================
# Session Configuration
# =================================
SESSION_SECRET=staging_session_secret_key_change_in_production
SESSION_MAX_AGE=86400000
SESSION_SECURE=false
SESSION_HTTP_ONLY=true
SESSION_SAME_SITE=lax

# =================================
# External API Configuration
# =================================
# Bank Account Integration (Sandbox)
PLAID_CLIENT_ID=staging_plaid_client_id
PLAID_SECRET=staging_plaid_secret
PLAID_PUBLIC_KEY=staging_plaid_public_key
PLAID_ENVIRONMENT=sandbox

# Currency Exchange Rates
EXCHANGE_RATE_API_KEY=staging_exchange_rate_api_key
EXCHANGE_RATE_BASE_CURRENCY=USD
EXCHANGE_RATE_UPDATE_INTERVAL=3600000

# =================================
# Feature Flags (All enabled for testing)
# =================================
ENABLE_BUDGET_ALERTS=true
ENABLE_CATEGORY_SUGGESTIONS=true
ENABLE_TRANSACTION_CATEGORIZATION=true
ENABLE_RECURRING_TRANSACTIONS=true
ENABLE_MULTI_CURRENCY=true
ENABLE_INVESTMENT_TRACKING=true
ENABLE_GOAL_TRACKING=true

# =================================
# Development Features (Enabled in Staging)
# =================================
ENABLE_HOT_RELOAD=false
ENABLE_DEBUG_MIDDLEWARE=true
ENABLE_PRETTY_LOGS=true
SEED_SAMPLE_DATA=true
SEED_RESET_ON_RESTART=false

# =================================
# Docker Compose Variables
# =================================
POSTGRES_DB=personal_finance_tracker_staging
POSTGRES_USER=postgres
POSTGRES_PASSWORD=staging_secure_password

# Container Ports
APP_PORT=3000
POSTGRES_PORT=5432
REDIS_PORT=6379

# Data Paths
POSTGRES_DATA_PATH=./data/staging/postgres
BACKUP_PATH=./data/staging/backups

# =================================
# PM2 Configuration
# =================================
PM2_INSTANCES=2
PM2_MAX_MEMORY=1024M

# =================================
# Build Configuration
# =================================
BUILD_DATE=2024-01-01T00:00:00Z
VERSION=1.0.0-staging
GIT_COMMIT=

# =================================
# Monitoring Services
# =================================
GRAFANA_PASSWORD=staging_grafana_password
PROMETHEUS_RETENTION_TIME=7d

# =================================
# Rate Limiting (More lenient for staging)
# =================================
GLOBAL_RATE_LIMIT_WINDOW=900000
GLOBAL_RATE_LIMIT_MAX=2000
AUTH_RATE_LIMIT_WINDOW=900000
AUTH_RATE_LIMIT_MAX=20

# =================================
# Testing Configuration
# =================================
# Enable features for testing
ENABLE_TEST_ENDPOINTS=true
ENABLE_MOCK_EXTERNAL_APIS=true
MOCK_EMAIL_DELIVERY=true

# Test data configuration
TEST_USER_EMAIL=test@staging.yourdomain.com
TEST_USER_PASSWORD=staging_test_password

# =================================
# Security Scanning
# =================================
SECURITY_SCAN_ENABLED=true
VULNERABILITY_SCAN_SCHEDULE=0 6 * * 1

# =================================
# Maintenance Mode
# =================================
MAINTENANCE_MODE=false
MAINTENANCE_MESSAGE=Staging environment is currently under maintenance.

# =================================
# Environment Notes
# =================================
# 1. This staging environment mirrors production but with relaxed security for testing
# 2. Use test/sandbox credentials for external services
# 3. Enable verbose logging for debugging
# 4. Allow sample data seeding for testing
# 5. Use separate database and Redis instances from production
# 6. Configure test email services (like Mailtrap) instead of production SMTP
# 7. Feature flags can be toggled for testing different scenarios